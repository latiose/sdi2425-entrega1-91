<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://thymeleaf.org">
<head th:replace="fragments/head"></head>
<body>
<!-- Barra de Navegación superior -->
<nav th:replace="fragments/nav"></nav>
<div class="container">
  <h2 th:text="#{refuels.list}"></h2>
  <p th:text="#{vehicle.selection.refuel}"></p>
  <div class="col-sm-10">
    <select id="plateNumber" class="form-control" name="plateNumber">
      <option th:each="plate : ${plateList}"
              th:value="${plate}"
              th:text="${plate}">
      </option>
    </select>
  </div>
  <script th:inline="javascript">
    function loadRefuelsForPlate(numberPlate) {
      fetch('/refuel/list/update?plateNumber=' + numberPlate, {
        method: 'GET',
        headers: {
          'X-Requested-With': 'XMLHttpRequest'
        }
      })
              .then(response => response.text())
              .then(html => {
                document.getElementById('refuelsTable').innerHTML = html;
              })
              .catch(error => console.error('Error updating refuels list:', error));
    }

    document.getElementById('plateNumber').addEventListener('change', function() {
      loadRefuelsForPlate(this.value);
    });

    document.addEventListener('DOMContentLoaded', function() {
      const plateSelect = document.getElementById('plateNumber');
      if (plateSelect.options.length > 0) {
        loadRefuelsForPlate(plateSelect.value);
      }
    });
  </script>
  <div class="table-responsive">
    <table class="table table-hover" th:fragment="refuelsTable" id="refuelsTable">
      <thead>
      <tr>
        <th scope="col">Fecha</th>
        <th scope="col">Hora</th>
        <th scope="col">Odómetro</th>
        <th scope="col">Combustible</th>
        <th scope="col">Estación de servicio</th>
        <th scope="col">Precio por unidad</th>
        <th scope="col">Cantidad</th>
        <th scope="col">Precio total</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="refuel : ${refuelsList}">
        <td th:text="${refuel.dayMonthYear}"></td>
        <td th:text="${refuel.hoursMinutes}"></td>
        <td th:text="${refuel.odometer}"></td>
        <td th:text="${refuel.vehicle.fuel}"></td>
        <td th:text="${refuel.station}"></td>
        <td th:text="${refuel.price}"></td>
        <td th:text="${refuel.amount}"></td>
        <td th:text="${refuel.totalPrice}"></td>
      </tr>
      </tbody>
    </table>
  </div>
  <footer th:replace="fragments/pagination"></footer>
</div>
<footer th:replace="fragments/footer"/>
</body>
</html>